<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
  <meta charset="utf-8">
  <meta name="generator" content="quarto-0.9.80">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <meta name="author" content="Hyesop Shin">
  <title>AGILE2022 Reproducible Codes</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>

  <script src="AGILE2022_files/libs/clipboard/clipboard.min.js"></script>
  <script src="AGILE2022_files/libs/quarto-html/quarto.js"></script>
  <script src="AGILE2022_files/libs/quarto-html/popper.min.js"></script>
  <script src="AGILE2022_files/libs/quarto-html/tippy.umd.min.js"></script>
  <script src="AGILE2022_files/libs/quarto-html/anchor.min.js"></script>
  <link href="AGILE2022_files/libs/quarto-html/tippy.css" rel="stylesheet">
  <link href="AGILE2022_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet">
  <script src="AGILE2022_files/libs/bootstrap/bootstrap.min.js"></script>
  <link href="AGILE2022_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
  <link href="AGILE2022_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet">
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body class="fullcontent">
<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">
<header id="title-block-header" class="quarto-title-block default">


<div class="quarto-title"><h1 class="title display-7">AGILE2022 Reproducible Codes</h1></div><div class="quarto-title-meta"><div><div class="quarto-title-meta-heading">Author</div><div class="quarto-title-meta-contents"><div class="quarto-title-authors"><p>Hyesop Shin</p></div></div></div></div></header>
<section id="data-exploration" class="level2">
<h2 class="anchored" data-anchor-id="data-exploration">Data Exploration</h2>
<section id="call-packages-and-data" class="level3">
<h3 class="anchored" data-anchor-id="call-packages-and-data">Call Packages and data</h3>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse) <span class="co"># data wrangling and plotting</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf) <span class="co"># Manipulating spatial files</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tmap) <span class="co"># Dealing with maps</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spgwr) <span class="co"># GWRs</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spdep) <span class="co"># moran's I</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As the data were all pre-cleaned, the csv files were all put into the same column key called <code>Name</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>strava <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"Cleaned Files/strava.csv"</span>) <span class="co"># response</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>green <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"Cleaned Files/green.csv"</span>) <span class="co"># predictors</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>ptai <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"Cleaned Files/ptai.csv"</span>) <span class="co"># predictors</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>buildings <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"Cleaned Files/buildings.csv"</span>) <span class="co"># predictors</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>shp <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">"Cleaned Files/Glasgow_IZ.shp"</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># merge all </span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>strava <span class="sc">%&gt;%</span> </span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(green, <span class="at">by =</span> <span class="st">"Name"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(ptai, <span class="at">by =</span> <span class="st">"Name"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(buildings, <span class="at">by =</span> <span class="st">"Name"</span>) <span class="ot">-&gt;</span> glasgow_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <a href="#fig-ridecorrelation">Figure&nbsp;1</a> shows the correlation between Strava 2017 and Strava 2018. The correlation is <code>0.9975779</code>, which means it is nearly identical - not what I expected!</p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(glasgow_df<span class="sc">$</span>ride17, glasgow_df<span class="sc">$</span>ride18)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(glasgow_df<span class="sc">$</span>ride17, glasgow_df<span class="sc">$</span>ride18)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>[1] 0.9975779</code></pre>
</div>
<div class="cell-output-display">
<div id="fig-ridecorrelation" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="AGILE2022_files/figure-html/fig-ridecorrelation-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption aria-hidden="true" class="figure-caption">Figure 1: Correlation of Strava 2017 against Strava 2018</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="exploring-the-variables" class="level2">
<h2 class="anchored" data-anchor-id="exploring-the-variables">Exploring the Variables</h2>
<p>To get an immediate understanding of the variables, the best thing is to map the variables and get summary tables. First, let us look at the summary of the variables.</p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>glasgow_df <span class="sc">%&gt;%</span> <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>     Name               ride17            ride18            green       
 Length:136         Min.   :   1760   Min.   :   2275   Min.   : 1.320  
 Class :character   1st Qu.:  32800   1st Qu.:  33606   1st Qu.: 5.780  
 Mode  :character   Median :  79293   Median :  81615   Median : 8.068  
                    Mean   : 128697   Mean   : 135287   Mean   : 8.837  
                    3rd Qu.: 153040   3rd Qu.: 168255   3rd Qu.:11.670  
                    Max.   :1312075   Max.   :1421505   Max.   :20.664  
      PTAI            height      
 Min.   : 245.8   Min.   : 5.667  
 1st Qu.: 542.8   1st Qu.: 7.358  
 Median : 808.5   Median : 8.098  
 Mean   :1022.2   Mean   : 9.029  
 3rd Qu.:1213.8   3rd Qu.: 9.566  
 Max.   :4990.8   Max.   :21.133  </code></pre>
</div>
</div>
<p>Here we transform the data to a longer format glasgow_df_long using the <code>pivot_longer</code> function. This is to directly execute ggplot with facet wrapping. After the data transformation, we then merge the shapefile with the integrated data frame that is <code>gl_shp</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>glasgow_df <span class="sc">%&gt;%</span> </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Strava2017 =</span> ride17,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">Strava2018 =</span> ride18) <span class="sc">%&gt;%</span> </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">!</span>Name,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"Type"</span>,</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"Value"</span>) <span class="ot">-&gt;</span> glasgow_df_long</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>shp <span class="sc">%&gt;%</span> </span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(glasgow_df_long, <span class="at">by =</span> <span class="st">"Name"</span>) <span class="ot">-&gt;</span> gl_shp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Lets look at the strava data first. Here we see that during 2017 and 2018 people including the City Centre South, Laurieston and Tradeston, City Centre East, Finnieston and Kelvinhaugh, and Calton and Gallowgate were identified as the most reported areas.</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Strava Users</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>gl_shp <span class="sc">%&gt;%</span> </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Strava2017"</span>, <span class="st">"Strava2018"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Value2 =</span> <span class="fu">cut</span>(Value,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">50000</span>, <span class="dv">100000</span>, <span class="dv">150000</span>, <span class="dv">200000</span>, <span class="dv">300000</span>, <span class="sc">+</span><span class="cn">Inf</span>),</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"0-50"</span>, <span class="st">"50-100"</span>, <span class="st">"100-150"</span>, <span class="st">"150-200"</span>, <span class="st">"200-30"</span>, <span class="st">"&gt;300"</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>() <span class="sc">+</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="st">"Value2"</span>, <span class="at">title =</span> <span class="st">"Strava ('000s)"</span>, <span class="at">palette=</span><span class="st">"-RdBu"</span>) <span class="sc">+</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_facets</span>(<span class="at">by =</span> <span class="st">"Type"</span>, <span class="at">free.coords =</span> F, <span class="at">free.scales =</span> F, <span class="at">ncol =</span> <span class="dv">2</span>) <span class="ot">-&gt;</span> gl_strava</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>gl_strava</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="AGILE2022_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode" id="cb9"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">#tmap_save(gl_strava, "strava.jpg", width = 1000, height = 400, dpi = 300)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The figures below show that the per cent of the greenness (by Immediate Zones) gradually tends to decrease as it goes outside the city centre. The average is 8% across the whole area but the lowest is situated in the city centre and the city south.</p>
<p>The height of the buildings were concentrated around the city centre. The City Centre South was the highest at 21.1% followed by City Centre East and City Centre West.</p>
<p>PTAI (Public Transport Availability Indicators) also tend to more clustered in the city centre (&gt;3000) and around the major bus routes (&gt;2000) while the north and the east were relatively lower (&lt;1000).</p>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Other variables</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>gl_shp <span class="sc">%&gt;%</span> </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"green"</span>, <span class="st">"PTAI"</span>, <span class="st">"height"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>() <span class="sc">+</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="st">"Value"</span>, <span class="at">title =</span> <span class="st">""</span>, <span class="at">palette=</span><span class="st">"-RdBu"</span>) <span class="sc">+</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_facets</span>(<span class="at">by =</span> <span class="st">"Type"</span>, <span class="at">free.coords =</span> F, <span class="at">free.scales =</span> T, <span class="at">ncol =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="st">"right"</span>, <span class="st">"top"</span>),  </span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">title.position =</span> <span class="fu">c</span>(<span class="st">'right'</span>, <span class="st">'top'</span>)) <span class="ot">-&gt;</span> gl_variable</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>gl_variable</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="AGILE2022_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode" id="cb11"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">#tmap_save(gl_variable, "variables.jpg", width = 1000, height = 2500, dpi = 300)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="ols-regression---log-transformation" class="level2">
<h2 class="anchored" data-anchor-id="ols-regression---log-transformation">OLS Regression - log transformation</h2>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Count data = Discrete Data</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co">#continuous: quantitative data that can take any value in some interval ⇒ linear models</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co">#discrete: quantitative data that takes a “countable” number of values</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co">#(e.g. 0, 1, 2, . . .) ⇒ generalised linear models (GLMs)</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co">#If your data are discrete but the counts are all fairly large, you can</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co">#ignore the discreteness and use linear models anyway. If you have small</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co">#counts and zeros though it is very important to use GLMs instead.</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>model17 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(ride17) <span class="sc">~</span> green <span class="sc">+</span> PTAI <span class="sc">+</span> height, <span class="at">data =</span> glasgow_df) </span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model17)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>
Call:
lm(formula = log(ride17) ~ green + PTAI + height, data = glasgow_df)

Residuals:
     Min       1Q   Median       3Q      Max 
-2.78035 -0.59604  0.08002  0.72427  1.76984 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 10.4216433  0.4704823  22.151  &lt; 2e-16 ***
green       -0.0656807  0.0232332  -2.827  0.00543 ** 
PTAI         0.0003435  0.0001738   1.976  0.05021 .  
height       0.1055714  0.0503079   2.099  0.03777 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.01 on 132 degrees of freedom
Multiple R-squared:  0.3153,    Adjusted R-squared:  0.2997 
F-statistic: 20.26 on 3 and 132 DF,  p-value: 7.342e-11</code></pre>
</div>
<div class="sourceCode" id="cb14"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">residuals</span>(model17) <span class="sc">%&gt;%</span> summary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>    Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
-2.78035 -0.59604  0.08002  0.00000  0.72427  1.76984 </code></pre>
</div>
<div class="sourceCode" id="cb16"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">#exp(coef(model17)["green"])</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co">#exp(coef(model17)["PTAI"])</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co">#exp(coef(model17)["height"])</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>car<span class="sc">::</span><span class="fu">vif</span>(model17)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>   green     PTAI   height 
1.248832 2.348481 2.368797 </code></pre>
</div>
<div class="sourceCode" id="cb18"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(model17, <span class="at">k=</span><span class="dv">3</span>) <span class="co"># k = parameter</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>[1] 399.5545</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb20"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>model18 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(ride18) <span class="sc">~</span> <span class="fu">log</span>(green) <span class="sc">+</span> <span class="fu">log</span>(PTAI) <span class="sc">+</span> <span class="fu">log</span>(height), <span class="at">data =</span> glasgow_df) </span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model18)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>
Call:
lm(formula = log(ride18) ~ log(green) + log(PTAI) + log(height), 
    data = glasgow_df)

Residuals:
    Min      1Q  Median      3Q     Max 
-3.0003 -0.6849  0.1573  0.7204  1.7476 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   6.6582     1.4025   4.747 5.29e-06 ***
log(green)   -0.4349     0.2028  -2.144   0.0338 *  
log(PTAI)     0.3947     0.1996   1.978   0.0500 .  
log(height)   1.2745     0.4919   2.591   0.0107 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.018 on 132 degrees of freedom
Multiple R-squared:  0.313, Adjusted R-squared:  0.2974 
F-statistic: 20.05 on 3 and 132 DF,  p-value: 9.058e-11</code></pre>
</div>
<div class="sourceCode" id="cb22"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">residuals</span>(model18)<span class="sc">%&gt;%</span> summary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
-3.0003 -0.6849  0.1573  0.0000  0.7204  1.7476 </code></pre>
</div>
<div class="sourceCode" id="cb24"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(model18, <span class="at">k=</span><span class="dv">3</span>) <span class="co"># k = parameter</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>[1] 401.6285</code></pre>
</div>
<div class="sourceCode" id="cb26"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">#exp(coef(model18)["green"])</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="co">#exp(coef(model18)["PTAI"])</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="co">#exp(coef(model18)["height"])</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co">#car::vif(model18)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb27"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>shp <span class="sc">%&gt;%</span> </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(glasgow_df, <span class="at">by =</span> <span class="st">"Name"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_cols</span>(</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">Residuals18 =</span> <span class="fu">residuals</span>(model18),</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">Residuals17 =</span> <span class="fu">residuals</span>(model17))) <span class="ot">-&gt;</span> glasgow_gwr</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(glasgow_gwr[<span class="st">"Residuals17"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="AGILE2022_files/figure-html/spatialjoin-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode" id="cb28"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>mapres17 <span class="ot">&lt;-</span> <span class="fu">qtm</span>(glasgow_gwr, <span class="at">fill =</span> <span class="st">"Residuals17"</span>) <span class="sc">+</span> <span class="fu">tm_legend</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="st">"right"</span>, <span class="st">"top"</span>))</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>mapres18 <span class="ot">&lt;-</span> <span class="fu">qtm</span>(glasgow_gwr, <span class="at">fill =</span> <span class="st">"Residuals18"</span>) <span class="sc">+</span> <span class="fu">tm_legend</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="st">"right"</span>, <span class="st">"top"</span>))</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>(plot_residuals <span class="ot">&lt;-</span> <span class="fu">tmap_arrange</span>(mapres17, mapres18, <span class="at">widths =</span> <span class="dv">5</span>, <span class="at">heights =</span> <span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stderr">
<pre><code>Variable(s) "Residuals17" contains positive and negative values, so midpoint is set to 0. Set midpoint = NA to show the full spectrum of the color palette.</code></pre>
</div>
<div class="cell-output-stderr">
<pre><code>Variable(s) "Residuals18" contains positive and negative values, so midpoint is set to 0. Set midpoint = NA to show the full spectrum of the color palette.</code></pre>
</div>
<div class="cell-output-stderr">
<pre><code>Variable(s) "Residuals17" contains positive and negative values, so midpoint is set to 0. Set midpoint = NA to show the full spectrum of the color palette.</code></pre>
</div>
<div class="cell-output-stderr">
<pre><code>Variable(s) "Residuals18" contains positive and negative values, so midpoint is set to 0. Set midpoint = NA to show the full spectrum of the color palette.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="AGILE2022_files/figure-html/spatialjoin-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode" id="cb33"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co">#tmap_save(plot_residuals, "Residuals.jpg")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb34"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Morans'I</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>nb <span class="ot">&lt;-</span> <span class="fu">poly2nb</span>(glasgow_gwr, <span class="at">queen=</span><span class="cn">TRUE</span>) <span class="co"># calculate neighbours queen continuity</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>listw <span class="ot">&lt;-</span> <span class="fu">nb2listw</span>(nb, <span class="at">style=</span><span class="st">"W"</span>, <span class="at">zero.policy=</span><span class="cn">TRUE</span>)</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>globalMoran17 <span class="ot">&lt;-</span> <span class="fu">moran.test</span>(glasgow_gwr<span class="sc">$</span>ride17, listw)</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>globalMoran18 <span class="ot">&lt;-</span> <span class="fu">moran.test</span>(glasgow_gwr<span class="sc">$</span>ride18, listw)</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>globalMoran17</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>
    Moran I test under randomisation

data:  glasgow_gwr$ride17  
weights: listw    

Moran I statistic standard deviate = 7.4908, p-value = 3.422e-14
alternative hypothesis: greater
sample estimates:
Moran I statistic       Expectation          Variance 
      0.369743016      -0.007407407       0.002534943 </code></pre>
</div>
<div class="sourceCode" id="cb36"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>globalMoran18</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>
    Moran I test under randomisation

data:  glasgow_gwr$ride18  
weights: listw    

Moran I statistic standard deviate = 7.4377, p-value = 5.125e-14
alternative hypothesis: greater
sample estimates:
Moran I statistic       Expectation          Variance 
      0.366035942      -0.007407407       0.002521030 </code></pre>
</div>
<div class="sourceCode" id="cb38"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>glasgow_sp <span class="ot">&lt;-</span> <span class="fu">as_Spatial</span>(glasgow_gwr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb39"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>gwr.bandwidth1 <span class="ot">&lt;-</span><span class="fu">gwr.sel</span>(<span class="fu">log</span>(ride18) <span class="sc">~</span> <span class="fu">log</span>(green) <span class="sc">+</span> <span class="fu">log</span>(PTAI) <span class="sc">+</span> <span class="fu">log</span>(height), </span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">data =</span> glasgow_sp,</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">adapt =</span> T) <span class="co">#estimated optimal bandwidth</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>Adaptive q: 0.381966 CV score: 142.0616 
Adaptive q: 0.618034 CV score: 143.3678 
Adaptive q: 0.236068 CV score: 139.4898 
Adaptive q: 0.145898 CV score: 134.2445 
Adaptive q: 0.09016994 CV score: 125.9838 
Adaptive q: 0.05572809 CV score: 120.7797 
Adaptive q: 0.03444185 CV score: 116.7516 
Adaptive q: 0.02128624 CV score: 116.2329 
Adaptive q: 0.0233313 CV score: 115.6423 
Adaptive q: 0.02719672 CV score: 115.7782 
Adaptive q: 0.02480776 CV score: 115.535 
Adaptive q: 0.0248742 CV score: 115.5361 
Adaptive q: 0.02470378 CV score: 115.5343 
Adaptive q: 0.02466309 CV score: 115.5343 
Adaptive q: 0.0246224 CV score: 115.5344 
Adaptive q: 0.02466309 CV score: 115.5343 </code></pre>
</div>
<div class="sourceCode" id="cb41"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>gwr.bandwidth1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>[1] 0.02466309</code></pre>
</div>
<div class="sourceCode" id="cb43"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>gwr.fit2<span class="ot">&lt;-</span><span class="fu">gwr</span>(<span class="fu">log</span>(ride17) <span class="sc">~</span> <span class="fu">log</span>(green) <span class="sc">+</span> <span class="fu">log</span>(PTAI) <span class="sc">+</span> <span class="fu">log</span>(height), </span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">data =</span> glasgow_sp, </span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>              <span class="co">#bandwidth = gwr.bandwidth1, </span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">adapt =</span> <span class="fl">0.03</span>,</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">se.fit=</span>T, </span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">hatmatrix=</span>T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stderr">
<pre><code>Warning in proj4string(data): CRS object has comment, which is lost in output; in tests, see
https://cran.r-project.org/web/packages/sp/vignettes/CRS_warnings.html</code></pre>
</div>
<div class="sourceCode" id="cb45"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>gwr.fit2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>Call:
gwr(formula = log(ride17) ~ log(green) + log(PTAI) + log(height), 
    data = glasgow_sp, adapt = 0.03, hatmatrix = T, se.fit = T)
Kernel function: gwr.Gauss 
Adaptive quantile: 0.03 (about 4 of 136 data points)
Summary of GWR coefficient estimates at data points:
                  Min.   1st Qu.    Median   3rd Qu.      Max.  Global
X.Intercept. -8.731857  4.029839  5.959533  9.867533 20.484225  7.0704
log.green.   -2.238252 -0.601015  0.011518  0.464072  1.999999 -0.4817
log.PTAI.    -0.793808 -0.042598  0.520201  0.971566  2.781898  0.3726
log.height.  -4.061775 -0.195953  0.456595  1.377357  3.483895  1.1824
Number of data points: 136 
Effective number of parameters (residual: 2traceS - traceS'S): 60.00132 
Effective degrees of freedom (residual: 2traceS - traceS'S): 75.99868 
Sigma (residual: 2traceS - traceS'S): 0.8268993 
Effective number of parameters (model: traceS): 45.31658 
Effective degrees of freedom (model: traceS): 90.68342 
Sigma (model: traceS): 0.7569927 
Sigma (ML): 0.6181391 
AICc (GWR p. 61, eq 2.33; p. 96, eq. 4.21): 397.165 
AIC (GWR p. 96, eq. 4.22): 300.4245 
Residual sum of squares: 51.96504 
Quasi-global R2: 0.7356606 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb47"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>results17 <span class="ot">&lt;-</span><span class="fu">as.data.frame</span>(gwr.fit2<span class="sc">$</span>SDF)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(results17)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code> [1] "sum.w"               "X.Intercept."        "log.green."         
 [4] "log.PTAI."           "log.height."         "X.Intercept._se"    
 [7] "log.green._se"       "log.PTAI._se"        "log.height._se"     
[10] "gwr.e"               "pred"                "pred.se"            
[13] "localR2"             "X.Intercept._se_EDF" "log.green._se_EDF"  
[16] "log.PTAI._se_EDF"    "log.height._se_EDF"  "pred.se.1"          </code></pre>
</div>
<div class="sourceCode" id="cb49"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>glasgow_gwr <span class="sc">%&gt;%</span> </span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(green, PTAI, height)) <span class="sc">%&gt;%</span> </span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(results17) <span class="ot">-&gt;</span> gwr_results17</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>strava17_localr2 <span class="ot">&lt;-</span> <span class="fu">qtm</span>(gwr_results17, <span class="at">fill =</span> <span class="st">"localR2"</span>) <span class="sc">+</span> <span class="fu">tm_legend</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="st">"right"</span>, <span class="st">"top"</span>))</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>strava17_green   <span class="ot">&lt;-</span> <span class="fu">qtm</span>(gwr_results17, <span class="at">fill =</span> <span class="st">"log.green."</span>)   <span class="sc">+</span> <span class="fu">tm_legend</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="st">"right"</span>, <span class="st">"top"</span>))</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>strava17_ptai    <span class="ot">&lt;-</span> <span class="fu">qtm</span>(gwr_results17, <span class="at">fill =</span> <span class="st">"log.PTAI."</span>)    <span class="sc">+</span> <span class="fu">tm_legend</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="st">"right"</span>, <span class="st">"top"</span>))</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>strava17_height  <span class="ot">&lt;-</span> <span class="fu">qtm</span>(gwr_results17, <span class="at">fill =</span> <span class="st">"log.height."</span>)  <span class="sc">+</span> <span class="fu">tm_legend</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="st">"right"</span>, <span class="st">"top"</span>))</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>(plot_2017 <span class="ot">&lt;-</span> <span class="fu">tmap_arrange</span>(strava17_localr2, strava17_green, strava17_ptai, strava17_height))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stderr">
<pre><code>Variable(s) "log.green." contains positive and negative values, so midpoint is set to 0. Set midpoint = NA to show the full spectrum of the color palette.</code></pre>
</div>
<div class="cell-output-stderr">
<pre><code>Variable(s) "log.PTAI." contains positive and negative values, so midpoint is set to 0. Set midpoint = NA to show the full spectrum of the color palette.</code></pre>
</div>
<div class="cell-output-stderr">
<pre><code>Variable(s) "log.height." contains positive and negative values, so midpoint is set to 0. Set midpoint = NA to show the full spectrum of the color palette.</code></pre>
</div>
<div class="cell-output-stderr">
<pre><code>Variable(s) "log.green." contains positive and negative values, so midpoint is set to 0. Set midpoint = NA to show the full spectrum of the color palette.</code></pre>
</div>
<div class="cell-output-stderr">
<pre><code>Variable(s) "log.PTAI." contains positive and negative values, so midpoint is set to 0. Set midpoint = NA to show the full spectrum of the color palette.</code></pre>
</div>
<div class="cell-output-stderr">
<pre><code>Variable(s) "log.height." contains positive and negative values, so midpoint is set to 0. Set midpoint = NA to show the full spectrum of the color palette.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="AGILE2022_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode" id="cb56"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co">#tmap_save(plot_2017, "GWR2017.jpg")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb57"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>gwr.bandwidth3 <span class="ot">&lt;-</span><span class="fu">gwr.sel</span>(<span class="fu">log</span>(ride18) <span class="sc">~</span> green <span class="sc">+</span> PTAI <span class="sc">+</span> height, </span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">data =</span> glasgow_sp,</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">adapt =</span> T) <span class="co">#estimated optimal bandwidth</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>Adaptive q: 0.381966 CV score: 138.8295 
Adaptive q: 0.618034 CV score: 140.5099 
Adaptive q: 0.236068 CV score: 136.1478 
Adaptive q: 0.145898 CV score: 131.5708 
Adaptive q: 0.09016994 CV score: 124.8027 
Adaptive q: 0.05572809 CV score: 122.1225 
Adaptive q: 0.03444185 CV score: 119.9508 
Adaptive q: 0.02128624 CV score: 122.0017 
Adaptive q: 0.03827299 CV score: 120.0087 
Adaptive q: 0.03560744 CV score: 119.9427 
Adaptive q: 0.03544382 CV score: 119.9438 
Adaptive q: 0.03662559 CV score: 119.9341 
Adaptive q: 0.03725484 CV score: 119.9401 
Adaptive q: 0.03650315 CV score: 119.9354 
Adaptive q: 0.03676456 CV score: 119.9324 
Adaptive q: 0.03695183 CV score: 119.9334 
Adaptive q: 0.03680959 CV score: 119.9324 
Adaptive q: 0.03685028 CV score: 119.9325 
Adaptive q: 0.03680959 CV score: 119.9324 </code></pre>
</div>
<div class="sourceCode" id="cb59"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>gwr.bandwidth3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>[1] 0.03680959</code></pre>
</div>
<div class="sourceCode" id="cb61"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>gwr.fit4<span class="ot">&lt;-</span><span class="fu">gwr</span>(<span class="fu">log</span>(ride18) <span class="sc">~</span> <span class="fu">log</span>(green) <span class="sc">+</span> <span class="fu">log</span>(PTAI) <span class="sc">+</span> <span class="fu">log</span>(height),</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">data =</span> glasgow_sp, </span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>              <span class="co">#bandwidth = gwr.bandwidth, </span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">adapt =</span> <span class="fl">0.03</span>,</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">se.fit=</span>T, </span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">hatmatrix=</span>T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stderr">
<pre><code>Warning in proj4string(data): CRS object has comment, which is lost in output; in tests, see
https://cran.r-project.org/web/packages/sp/vignettes/CRS_warnings.html</code></pre>
</div>
<div class="sourceCode" id="cb63"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>gwr.fit4</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>Call:
gwr(formula = log(ride18) ~ log(green) + log(PTAI) + log(height), 
    data = glasgow_sp, adapt = 0.03, hatmatrix = T, se.fit = T)
Kernel function: gwr.Gauss 
Adaptive quantile: 0.03 (about 4 of 136 data points)
Summary of GWR coefficient estimates at data points:
                  Min.   1st Qu.    Median   3rd Qu.      Max.  Global
X.Intercept. -7.769362  3.678493  5.881757  9.826402 20.373772  6.6582
log.green.   -1.958333 -0.551865  0.050780  0.475435  1.994233 -0.4349
log.PTAI.    -0.916947 -0.042468  0.505736  1.007547  2.647373  0.3947
log.height.  -3.561503 -0.038169  0.577012  1.657941  3.874595  1.2745
Number of data points: 136 
Effective number of parameters (residual: 2traceS - traceS'S): 60.00132 
Effective degrees of freedom (residual: 2traceS - traceS'S): 75.99868 
Sigma (residual: 2traceS - traceS'S): 0.8352189 
Effective number of parameters (model: traceS): 45.31658 
Effective degrees of freedom (model: traceS): 90.68342 
Sigma (model: traceS): 0.764609 
Sigma (ML): 0.6243583 
AICc (GWR p. 61, eq 2.33; p. 96, eq. 4.21): 399.888 
AIC (GWR p. 96, eq. 4.22): 303.1475 
Residual sum of squares: 53.01596 
Quasi-global R2: 0.7335358 </code></pre>
</div>
<div class="sourceCode" id="cb65"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>results18 <span class="ot">&lt;-</span><span class="fu">as.data.frame</span>(gwr.fit4<span class="sc">$</span>SDF)</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(results18)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code> [1] "sum.w"               "X.Intercept."        "log.green."         
 [4] "log.PTAI."           "log.height."         "X.Intercept._se"    
 [7] "log.green._se"       "log.PTAI._se"        "log.height._se"     
[10] "gwr.e"               "pred"                "pred.se"            
[13] "localR2"             "X.Intercept._se_EDF" "log.green._se_EDF"  
[16] "log.PTAI._se_EDF"    "log.height._se_EDF"  "pred.se.1"          </code></pre>
</div>
<div class="sourceCode" id="cb67"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>glasgow_gwr <span class="sc">%&gt;%</span> </span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(green, PTAI, height)) <span class="sc">%&gt;%</span> </span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(results18) <span class="ot">-&gt;</span> gwr_results18</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>strava18_localr2 <span class="ot">&lt;-</span> <span class="fu">qtm</span>(gwr_results18, <span class="at">fill =</span> <span class="st">"localR2"</span>) <span class="sc">+</span> <span class="fu">tm_legend</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="st">"right"</span>, <span class="st">"top"</span>))</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>strava18_green <span class="ot">&lt;-</span> <span class="fu">qtm</span>(gwr_results18, <span class="at">fill =</span> <span class="st">"log.green."</span>)     <span class="sc">+</span> <span class="fu">tm_legend</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="st">"right"</span>, <span class="st">"top"</span>))</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>strava18_ptai <span class="ot">&lt;-</span> <span class="fu">qtm</span>(gwr_results18, <span class="at">fill =</span> <span class="st">"log.PTAI."</span>)       <span class="sc">+</span> <span class="fu">tm_legend</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="st">"right"</span>, <span class="st">"top"</span>))</span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>strava18_height <span class="ot">&lt;-</span> <span class="fu">qtm</span>(gwr_results18, <span class="at">fill =</span> <span class="st">"log.height."</span>)   <span class="sc">+</span> <span class="fu">tm_legend</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="st">"right"</span>, <span class="st">"top"</span>))</span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>(plot_2018 <span class="ot">&lt;-</span> <span class="fu">tmap_arrange</span>(strava18_localr2, strava18_green, strava18_ptai, strava18_height))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stderr">
<pre><code>Variable(s) "log.green." contains positive and negative values, so midpoint is set to 0. Set midpoint = NA to show the full spectrum of the color palette.</code></pre>
</div>
<div class="cell-output-stderr">
<pre><code>Variable(s) "log.PTAI." contains positive and negative values, so midpoint is set to 0. Set midpoint = NA to show the full spectrum of the color palette.</code></pre>
</div>
<div class="cell-output-stderr">
<pre><code>Variable(s) "log.height." contains positive and negative values, so midpoint is set to 0. Set midpoint = NA to show the full spectrum of the color palette.</code></pre>
</div>
<div class="cell-output-stderr">
<pre><code>Variable(s) "log.green." contains positive and negative values, so midpoint is set to 0. Set midpoint = NA to show the full spectrum of the color palette.</code></pre>
</div>
<div class="cell-output-stderr">
<pre><code>Variable(s) "log.PTAI." contains positive and negative values, so midpoint is set to 0. Set midpoint = NA to show the full spectrum of the color palette.</code></pre>
</div>
<div class="cell-output-stderr">
<pre><code>Variable(s) "log.height." contains positive and negative values, so midpoint is set to 0. Set midpoint = NA to show the full spectrum of the color palette.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="AGILE2022_files/figure-html/Strava2018-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode" id="cb74"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co">#tmap_save(plot_2018, "GWR2018.jpg")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</main>
<!-- /main column -->
<script type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    setTimeout(function() {
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->


</body></html>